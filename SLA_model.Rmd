---
title: "SLA model"
output: html_document
---
# option 
```{r setup, include=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE)
rm(list = ls())

library(dplyr)
library(ggplot2)
library(car)

path <- "C:\\Users\\emduc\\Desktop\\Drive\\symphostage\\"
```

```{r}
data_standar <- read.csv(file.path(path, "data_standar.csv"),header = T, dec = ".", sep=",")%>%  mutate(Dawkins = as.factor(Dawkins))
```



# model 

Ackerly et al. (2002)found that SLA was significantly correlated with soil water availability and potential solar insolation. To test this hypothesis too we are going to selected solar insolation variable like lBAL, d_gap and aspect, and variable that depict soil water availability like Wetness wich also give the information of bottomland area which correspond to  river bed area and caratized by a wetness value  between 1.395 and 8.010.

Bottom land area are knonw to be more biologically dynamic which means stand renewal is faster due more frequent tree fall which induce more light gap. An other particularity of bottom land is that the mean canopy hight is lower thant on oter are like slope and hilltop (voir cours st√©phane ?), so once again proxymity to creek or being in hight wetness value maybe modulate positvly  light availabilty.  

For every tree sapling and early ontogenic  stage individual are in the uner layer of canopy and as we know light availability descrease from canopy to the ground (ref ? maybe espacially un tropical rain forest). Thus SLA value for younger individual would be hight to maximise light interceptection and so their growth through a better photosynthetic rate. The only variable that depict ontogenic stage is the diameter at breast height and would modulate SLA value but could also habe many interaction with other variable as diamter can inluence competition impact if the diameter of the focal tree is for example highter than its neighbors. Or diamter interaction with d_gap because bigger tree could benefit more from gap light than maybe a smaller one same for creek proximity.



```{r SLA mixte ,echo=F}
SLA_model <-lm(formula = SLA ~  ombrage+ lBAL + lBAL:diameter+ d_creek + wetness + d_gap + d_gap:diameter+d_creek:diameter + wetness:diameter +Dawkins
    , data = data_standar )

summary(SLA_model)
```

Adjusted R-squared:  0.2728 so  27.28% of the total variance of SLA value are explained by this model.  Then the H0 of the F statistic test is rejected so there is only 2.2e-16 to made a mistkae when we consider that this model explain something. 

In this SLA_model, a significative p-value of the t-test means that the coefficient is significantly (alpha = 0.05) different from zero. Only beta for aspect, diameter , lBAL:diameter , d_creek: diameter are different from zero.

So, we are going to remove variables withou significant coiefficient : wetness, lBAL, d_creek,d_gap, d_gap:diameter, diameter:wetness, aspect:diameter

```{r}
SLA_model<- lm(formula = SLA ~   Dawkins  , data = data_standar) 

summary(SLA_model)
```

So SLA value can be explain by : 

  - the exposition of the cell (aspect) : difficulte to interpret because 0 and 360 correspond to north ... 
  
  -diameter have an negative coefficient which mean bigger is the diameter smaller is the SLA.
  
  - the interaction between diameter: lBAL , with a negative coefficient so the effect of diameter decrease when the LBAL value decrease too. For a given diameter , a tree with low neighbour crowding (lBAL) would have an highter SLA value than a same diameter with hight neighbors crowding. 
  
  - diameter:creek, interaction has a positive coefficient so the effect of diameter increased on the SLA when the distance to the creek increase too. So for a given diameter, tree located far from the creek have smaller SLA value than tree with same diameter closer to the creek.(link with water use efficiency and water availability ?)

```{r}
par(mfrow = c(2,2))
plot(SLA_model)
```
  
  - residuals vs fitted seems to be right maybe the variance is a bit increasing when SLA increased too but log transformation do not change this trend. Also three outliers is highlighted 76, 151 and 363. 
  - QQplot seems right too exepct for three outlilers 
  - Scale location plot, the red line trend has to be around 0.9, it is not exactly right.     - Residuals vs leverage none of the individuals pass over the cook distance limits but some of them seems to have a strong leverage that can influence the model

As the residuals analysis of the SLA_model seems to good, we can start the result interpretation.

```{r}
rbind(data_standar[66,], data_standar[55,],data_standar[79,])
```
The outliers here correspond two SLA outliers spotted previously with boxplot 13_2_73 and 15_1_198 is also an LMDC outliers and the other one 7_3_2806  is not spotted by boxplot.




```{r}
step_data <- data_standar %>%  dplyr::select(-X, -n_parcelle, -n_carre, -n_arbre, -LT_mean, -LMDC, -Area_exclude, -Chloro_content, -ID)

#SLA_full <- lm(formula = SLA ~., data = step_data)

#step(SLA_full, data = step_data , direction = "backward")
        
```

```{r}
summary(lm(formula = SLA ~ Dawkins + d_creek + diameter + ombrage, data = step_data))
```
