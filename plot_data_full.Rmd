---
title: plot data
output: 
  html_document:
    toc: yes
    toc_float: yes
---

```{r doc settings,  package, message=FALSE, warning=FALSE}
rm(list = ls())
knitr::opts_chunk$set(eval = T, cache = T, message = F, warning=F)
library(dplyr)
library(magrittr)
library(ggplot2)
library(ggpubr)
library("gridExtra")
library("cowplot")
```

# data upload
 
```{r}
Traits_brut_data <- read.csv("C:\\Users\\emduc\\Desktop\\Drive\\symphostage\\Full_traits_data.csv",header = T, dec = ",", sep=";")
```

Transform mean individuals data because we are looking for inter-individual variation and not intra-individual only for numeric variables here 

```{r}
Trait_mean_individuals_num <- Traits_brut_data %>% 
  group_by(n_parcelle, n_carre, n_arbre) %>% 
  summarize_at(c("Area_exclude", "Area_include", "Fresh_weight", "Dry_Weight", "SPAD_mean", "LT_mean", "Branch_diameter", "Bark_thickness", "Bark_infra_density", "Wood_infra_density" ), mean, na.rm = T)
```

And here for non numeric information like Dawkins and morphotype

```{r}
Trait_mean_individuals_vect<- Traits_brut_data %>% 
  select(n_parcelle, n_carre, n_arbre, morphotype, Dawkins, diameter, Bois) %>% 
  group_by(n_parcelle, n_carre, n_arbre, morphotype, Dawkins, diameter, Bois) %>%
    summarize()
```



# transformed trait 

We are going to add transformed trait to our data table like Leaf Dry Mass Content (LMDC), Specific Leaf Area (SLA) and Chorophyll content from SPAD

```{r}
Trait_mean_transform <- Trait_mean_individuals_num %>% 
  mutate(SLA = Area_exclude / Dry_Weight) %>% 
  mutate(LMDC = Dry_Weight/ Fresh_weight) %>% 
  mutate(Chloro_content = ((154.1* SPAD_mean)/(197.6-SPAD_mean))) %>% 
  select(n_parcelle, n_carre, n_arbre, "LT_mean", "Branch_diameter", "Bark_thickness", "Bark_infra_density", "Wood_infra_density", LMDC, SLA, Chloro_content)
```


chlorophyll content transformation come from Coste et al 2010 but with parameters from papers and not re-fitted with our data .. 
And now merging trait mean num and vect to have an complete mean trait value table 

```{r}
Trait_mean_transform_final <- merge(Trait_mean_transform, Trait_mean_individuals_vect, by = c("n_parcelle", "n_carre", "n_arbre") ) %>%
  mutate(Dawkins = gsub("A","",Dawkins)) %>% 
  mutate(Dawkins = gsub("B","",Dawkins)) %>% 
  mutate(Dawkins = gsub("C","",Dawkins)) %>% 
  mutate(Dawkins = as.factor(as.integer(Dawkins))) %>% 
  filter( SLA < 200) %>% 
  filter(Dawkins != "") %>% 
  mutate(Bois = as.factor(as.character(Bois))) %>% 
  mutate( basal_area = (pi* (diameter)^2)/4)

#write.csv2(Trait_mean_transform_final , "C:\\Users\\emduc\\Desktop\\Drive\\symphostage\\Full_traits_transform.csv")

```


# plot 
## simple trait 
### SLA distribution 

```{r}
 Trait_mean_transform_final %>%    
ggplot( aes(SLA))+
  geom_histogram(na.rm= T, binwidth = 4)
```

There are two individuals that have aberrant SLA value 11-1-742 : 842 and 11-4-983 : 489 

### LMDC distribution 

```{r}
ggplot(Trait_mean_transform_final, aes(LMDC))+
  geom_histogram(binwidth = 0.008)
```



  
### LT distribution 

```{r}
ggplot(Trait_mean_transform_final, aes(LT_mean))+
  geom_histogram(na.rm = T, binwidth = 12)
```

### Chlorophylle content distribution 

```{r}
ggplot(Trait_mean_transform_final, aes(Chloro_content))+
  geom_histogram(na.rm = T, binwidth = 2)
```

## double trait 
### SLA ~ LMDC

```{r }
Trait_mean_transform_final %>%   
ggplot(aes(SLA, LMDC, color= morphotype, size = diameter))+
  geom_jitter(na.rm=T)+
  labs(title = "", y="Leaf Dry Matter Content (LMDC) in g", x="Specific leaf area (SLA)")
```


```{r }
Trait_mean_transform_final %>% 
ggplot(aes(SLA, LMDC))+
  geom_density2d(na.rm=T )+
  background_grid(major = "xy", minor = "none")
```


```{r }
P_sp.1 <- Trait_mean_transform_final %>% 
  filter(morphotype == "sp.1") %>% 
ggplot(aes(SLA, LMDC))+
  geom_density2d()+
  background_grid(major = "xy", minor = "none")

P_globu <- Trait_mean_transform_final %>% 
  filter(morphotype == "globulifera") %>% 
ggplot(aes(SLA, LMDC))+
  geom_density2d()+
  background_grid(major = "xy", minor = "none")

P_indet <- Trait_mean_transform_final %>% 
  filter(morphotype == "Indet.") %>% 
ggplot(aes(SLA, LMDC))+
  geom_density2d()+
  background_grid(major = "xy", minor = "none")

P_sp.1_indent <- Trait_mean_transform_final %>% 
  filter(morphotype != "globulifera") %>% 
ggplot(aes(SLA, LMDC))+
  geom_density2d()+
  background_grid(major = "xy", minor = "none")

plot_grid(P_sp.1, P_globu, P_indet, P_sp.1_indent   , labels=c("A", "B","C", "D"), ncol = 2, nrow = 2)
```

### LMDC ~ LT 

```{r}
ggplot(Trait_mean_transform_final, aes(LT_mean, LMDC, color= morphotype, size = diameter))+
  geom_jitter(na.rm=T)
```

```{r }
ggplot(Trait_mean_transform_final,aes(LT_mean, LMDC))+
  geom_density2d(na.rm=T, col = "orange")
```


### SLA ~ LT 

```{r}
Trait_mean_transform_final %>%  filter(SLA < 200) %>% 
ggplot( aes(LT_mean, SLA, color= morphotype, size = diameter))+
  geom_jitter(na.rm=T)
```

```{r }
ggplot(Trait_mean_transform_final,aes(LT_mean ,SLA))+
  geom_density2d(na.rm=T, col = "orange")
```


### Chlorophylle content ~ SLA 

```{r}
Trait_mean_transform_final %>%  filter(SLA < 200) %>% 
ggplot( aes(SLA, Chloro_content, color= morphotype, size = diameter))+
  geom_jitter(na.rm=T)
```

```{r }
ggplot(Trait_mean_transform_final,aes(SLA,Chloro_content))+
  geom_density2d(na.rm=T, col = "orange")
```
### Chlorophylle content ~ LMDC


```{r}

ggplot(Trait_mean_transform_final , aes(LMDC, Chloro_content, color= morphotype, size = diameter))+
  geom_jitter(na.rm=T)
```

```{r }
ggplot(Trait_mean_transform_final,aes(LMDC,Chloro_content))+
  geom_density2d(na.rm=T, col = "orange")
```
### Chlorophylle content ~ LT


```{r}

ggplot(Trait_mean_transform_final  ,aes(LT_mean, Chloro_content, color= morphotype, size = diameter))+
  geom_jitter(na.rm=T)
```

```{r }
ggplot(Trait_mean_transform_final,aes(LT_mean,Chloro_content))+
  geom_density2d(na.rm=T, col = "orange")
```

### Wood density ~ bark density
```{r}
Trait_mean_transform_final %>%  
ggplot( aes(Wood_infra_density, Bark_infra_density, color= morphotype, size = diameter))+
  geom_jitter(na.rm=T)
```

## Trait and environment 
### SLA ~ Dawkins 
```{r}
Trait_mean_transform_final %>%   
ggplot( aes(x = diameter, y = SLA, color= Dawkins))+
  geom_point()
```
there is one individuals without Dawkins evaluation that have been removed at the begining.

We can see that there is a logical correlation between Dawkins and diameter so this subjective evaluation is quite good (developp why "logical") . Then smaller is the Dawkins score highter is the SLA value. It is not suprising because SLA reflect the leaf acquisition capacity and for individuals under the canopy light is less evalable so having hight SLA value allow to intercept more light and so maximise growth in adverse conditions (Long et al 2011).

```{r}
Trait_mean_transform_final %>% 
ggplot( aes(x = Dawkins, y =SLA , fill = Dawkins))+
  geom_boxplot()+
   stat_compare_means(method = "anova", 
                     label.y = 250) +
  stat_compare_means(method = "t.test", 
                     label = "p.signif",
                     ref.group = ".all.",
                     label.y = 225)
  

```
 
```{r}
Trait_mean_transform_final %>% 
  aov(SLA ~ Dawkins, data=.) %>% 
  TukeyHSD()
```


## Branch wood presence ~ diameter 

```{r}
ggplot(Trait_mean_transform_final, aes(x= Dawkins, y= Bois, size = diameter, color = morphotype))+
  geom_jitter()
```
Repartition between diameter category seems to be homogene, so there is no link between branch sample and diameter. Broken branches does not come from weaker wood from older or younger individual with diameter used as a proxy for the "age".




#ACP 


```{r}
library(FactoMineR)


ACP_data<- Trait_mean_transform_final %>% 
  select(LMDC, SLA, Chloro_content, LT_mean, morphotype, diameter,  Wood_infra_density, Bark_thickness, Bark_infra_density) 


res.pca <- PCA(ACP_data, quali.sup = 5)
plot.PCA(res.pca, axes=c(1,2), choix="var" , habillage= "morphotype") #choix="ind"

```
That a bit surprising because when SLA and LMDC are plotted together it seems to related but here they are not so much .. And this is the same for LT ... 

So Chlorophyll content can be reduce to LMDC and LT by diameter ? 

"Missing values are imputed by the mean of the variable: you should use the imputePCA function of the missMDA package"


## diameter ~ LT
```{r}
Trait_mean_transform_final %>%  
ggplot(aes(LT_mean,diameter, color= morphotype))+
  geom_jitter(na.rm=T)
```

 
Within individuals, many studies have shown that outer-canopy ‘sun’ leaves tend to be thicker than those from more-shaded parts of the canopy. So thickness is related to light availability and as we previously saw diameter is positively related to Dawkins and therefore to individual light availibity. So this is not suprising that bigger is the diameter, thicker leaves are gonna be. 

## SLA ~diameter 

```{r}
Trait_mean_transform_final %>%   
ggplot(aes(diameter, LT_mean, color= morphotype))+
  geom_jitter(na.rm=T)
```

